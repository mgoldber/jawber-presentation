<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mark n' Munch</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,700i" rel="stylesheet">
    <!-- Favicon -->
    <link rel="shortcut icon" href="https://storage.pardot.com/427982/227149/hackeryou_icon.png" />
    <!-- FontAwesome: -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
        integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="styles/styles.css">
</head>
<body>
    <!-- header -->
    <header>
        <img src="http://assets.hackeryou.com/hackeryou-logo.svg" alt="HackerYou red square logo." class="logo">
        <img src="http://assets.hackeryou.com/hy-logo-text.svg" alt="HackerYou logo text: college of technology" class="logo-text">
    </header>

    <h1 class="head-text">Mark n' Munch - Making an API</h1>
    <main>
        <!-- side nav -->
        <aside>
            <nav>
                <ul>
                    <li>
                        <a href="#tools">Tools</a>
                    </li>
                    <li>
                        <a href="#why">Why Do It?</a>
                    </li>
                    <li>
                        <a href="#started">Getting Started</a>
                    </li>
                    <li>
                        <a href="#databases">Databases</a>
                    </li>
                    <li>
                        <a href="#gotchas">Gotchas</a>
                    </li>
                    <li>
                        <a href="#deployment">Deployment</a>
                    </li>
                    <li>
                        <a href="#updating">Updating</a>
                    </li>
                </ul>
            </nav>

        </aside><!-- side nav end -->

        <!-- main notes -->
        <div class="wrapper">

            <h2 class="heading">Welcome to Mark n' Munch</h2>

            <h3>We are going to learn about making your own API for teaching purposes</h3>

            <p>Our goal is to learn about building a scaleable and descriptive API that is accurately
            representative of APIs students may experience in the wild.</p>

            <!-- get starated section -->
            <section class="get-started" id="tools">
                <h2 class="heading">Tools</h2>
                <h3>NodeJS</h3>
                <p>Node allows us to run JavaScript on the server. Node allows us to
                    run our API, communicate with our database, and complete build related tasks.
                </p>

                <h3>MongoDB</h3>
                <p>This is a popular and great choice for your database since data is organized
                    into JSON documents, which interacts nicely with our full JavaScript stack.
                </p>

                <h3>Mongoose</h3>
                <p>Mongoose is utilized for our connection between Node and MongoDB. Known as an Object Data Modelling Library (ODM). In addition, within our
                    server file, mongoose is used to establish the connection to our database. It includes built-in type casting, validation, query building, business logic hooks, and more, out of the box.
                </p>

                <h3>JWT</h3>
                <p>This is a module that we can use to generate a randomized token for us. It also gives us some
                    handy token validation methods.
                </p>

                <h3>Express</h3>
                <p>This allows us to simplify our routing, and provides immensely helpful methods to keep our HTTP
                    requests simplified and clean.
                </p>
            </section><!-- get started end -->

            <!-- Why Do It section -->
            <section class="why" id="why">
                <h2 class="heading" id="why">Why Do It?</h2>
                <h3>Control</h3>
                <p>Relying on other people's APIs when teaching is tough. If the API goes down, 
                    someone is having trouble getting their API key, or other problems arise, we
                    are at the mercy of the API.
                </p>
                <p>With our own API, we can generate back up tokens, respond faster if the 
                    API goes down, develop the API to meet the course's exact needs, and more!
                </p>

                <h3>Style points</h3>
                <p>It makes us look cool.</p>

                <img src="https://media.giphy.com/media/27npJ7KfvMsoM/giphy.gif" />

            </section><!-- Why Do It section end -->

            <!-- getting started section -->
            <section class="variables" id="started">
                <h2 class="heading">Getting Started</h2>

                <p>I like to visualize how everything works by going through the whole flow of information from the front end to the back end and then bringing it back again.</p>

                <img src="assets/step1.jpg" alt="diagram of front end connecting to back end with link between react and node circled">

                <h5>Front - Login.js</h5>

                <img src="assets/axios_api_login_signup.png" alt="front-end call to users endpoint inside of try-catch block">

                <img src="assets/step2.jpg" alt="diagram of front end connecting to back end with post info into DB circled">

                <h5>Back - userRoutes.js</h5>
                <img src="assets/login_endpoint_1.png" alt="screenshot of the login endpoint in the userRoutes file">
                
                <h5>Back - userService.js</h5>
                <img src="assets/is_user_function.png" alt="screenshot of function used to check if a user already exists in the database">

                <h5>Back - userModel.js</h5>
                <img src="assets/user_schema.png" alt="screenshot of the user schema">

                <h5>Back - tokenService.js</h5>
                <img src="assets/tokenservice.png" alt="screenshot of tokenservice function">

                <img src="assets/step3.jpg" alt="diagram of front end connecting to back end with send back object circled">
                <h5>Back - userRoutes.js</h5>
                <img src="assets/login_endpoint.png" alt="screenshot of the login endpoint of the router">

                <img src="assets/step4.jpg" alt="diagram of front end connecting to back end with return json object circled">
                <h5>Front - Login.js</h5>
                <img src="assets/token_access_login.png" alt="screenshot of the token retrieval from login front end">

                <h3 id="declaration">Routes vs. Middleware vs. Utils</h3>
                <h4>Routes</h4>
                <p>This will hold the information specifying what happens when the endpoints of our API are hit.</p>
                <h5>Node without Express</h5>
                <img src="assets/node_without_express_highlighted.png" alt="screenshot of what writing node without express might look like">
                <img src="https://media.giphy.com/media/pVAMI8QYM42n6/giphy.gif" alt="gif of Jim Carry being sick"/>
                <p></p>
                <img src="assets/router_highlited.png" alt="screenshot of the router route highlited in the route file">

                <h4>Middleware</h4>
                <p>Middleware are functions that have access to the request object (req), response object (res), and the next function. Middleware functions can execute any code, make changes to request and response objects, end the request-response cycle, and call the next middleware in the stack.</p>
                <img src="assets/middlewareexplained.png" alt="screenshot of the breakdown of middleware in Express">

                <img src="assets/middleware_highlighted.png" alt="screenshot of the router middleware highlited in the route file">
                
                <h5>Auth Middleware Example</h5>
                <img src="assets/authorization_middleware.png" alt="screenshot of authorization middleware function">
                
                <p></p>
                <img src="assets/authorization_middleware_used.png" alt="screenshot of authorization middleware function being called">

                <h4>Utils</h4>
                <p>This will hold our helper functions, as well as any constants that are required in our application.</p>

                <img src="assets/tokenservice.png" alt="screenshot of tokenservice function">

                <h3 id="declaration">Routes: Models and Services</h3>
                <h4>Models</h4>
                <p>This is where we set up our schema. This maps to the way our information is stored in our database.</p>

                <img src="assets/user_schema.png" alt="screenshot of the user schema">
                <p></p>
                <img src="assets/user_in_db.png" alt="screenshot of authorization middleware function being called">

                <h4>Services</h4>
                <p>This will contain helper functions that we can use within our routes to perform important actions and reduce code repetition.</p>  
                
                <img src="assets/is_user_function.png" alt="screenshot of function used to check if a user already exists in the database">
                
                <h3 id="declaration">Server.js</h3>
                <p>This is like the package.json file of the backend</p>
                <p>This serves as the entry point for our API. Within here, we will set up configurations, link the various segments of our API, and start the server and connection to our database.</p>

                <h5>Back - server.js</h5>
                <img src="assets/serverjs.png" alt="screenshot of the server starting by pulling in the routes">

                <h5>Sample folder structure of API</h5>
                <img style="width:300px;" src="assets/api_folder_structure.png" alt="screenshot of the folder structure for the API">
                <p></p>
                <img style="width:300px;" src="assets/api_folder_talked.png" alt="screenshot of the folder structure for the API with highlights of what we talked about">
            </section><!--getting started section end-->

            <!-- types -->
            <section id="databases">
                <h2 class="heading">Databases</h2>
                <p>Thinking about database structure and how our collections relate will help us structure our code!</p>
                <p>For example, a party venue can have <span class="bold">multiple</span> attendees, but each attendee is <span class="bold">only at one</span> venue at any given time.</p>
                <p></p>
                <p></p>

                <h3 id="concatination">Database Relationships</h3>
                <p>It's important to understand how different collections relate to one another, even if the proper terminology isn't used to describe these relationships.</p>

                <h5>Venue collection</h5>
                <img src="assets/venue_database_highlighted.png" alt="screenshot of a venue entry in the party animals database">
                <h5>Animal collection</h5>
                <img src="assets/animal_database_highlighted.png" alt="screenshot of a animal entry in the party animals database">

                <h5>Sample New Animal Creation</h5>
                <img style="width: 60%;" src="assets/animalcreation_highlighted.png" alt="screenshot of the code to create a new animal in the system">
            </section><!-- end of types -->

            <!-- gotchas -->
            <section class="gotchas" id="gotchas">
                <h2 class="heading">Gotchas</h2>
                <p>The biggest gotcha I personally experienced was dealing with authentication through email verification.</p>
                <p>The same token that your users get when creating an account cannot be used to lock down routes that create a new entry in the database.</p>
                <p>I had never completed any email validation before so figuring out that flow was super confusing for me.</p>
                
                <h5>Sendgrid Email Validation</h5>
                <img src="assets/sendgrid_validation_highlighted.png" alt="screenshot of sendgrid validation function">
                <h5>Confirmation Route</h5>
                <img src="assets/confirmation_route_highlighted.png" alt="screenshot of confirmation route linked to sendgrid validation">
                <h5>User entity</h5>
                <img src="assets/verified_admin_flags.png" alt="screenshot of a user entry in the database">
                <h5>isAdmin validation</h5>
                <img src="assets/isadmin_flag_highlighted.png" alt="code showing how to use the isAdmin flag for securing">
            </section><!--end of gotchas-->

            <!-- deployment section -->
            <section class="deployment" id="deployment">
                <h2 class="heading">Deployment</h2>
                <p>I found no enjoyment in this part of the process.</p>
                <h4>High Level Steps:</h4>
                <p>1. Create a new Ubuntu droplet within the HackerYou project on Digital Ocean.</p>
                <p>2. SSH onto the remote server (Digital Ocean will provide you with the IP after set up).</p>
                <p>3. Get Nginx and Node.js installed onto the remote server.</p>
                <ul>
                    <li>Nginx is one of the most popular web servers in the world. Load balances our traffic for us.</li>
                </ul>
                <p>4. Get PM2 installed.</p>
                <ul>
                    <li>PM2 is a production process manager for Node applications that allows you to keep applications alive forever.</li>
                </ul>
                <h5>package.json</h5>
                <img src="assets/pm2_script_packagejson.png" alt="screenshot of the configuration to get pm2 running in production">
                <p>5. Git your codebase onto the remote server.</p>
                <p>6. Use PM2 to start up your application.</p>

                <h3>From HTTP to HTTPS:</h3>
                <p>We use something called Let's Encrypt which is a certificate authority that provides an easy way to
                obtain and install free TLS/SSL certificates letting us have some encrypted HTTPS on the server.</p>
                <p>It provides us with a software client called Certbot.</p> 

                <h4>High Level Steps:</h4>
                <p>1. Install Certbot on remote server.</p>
                <p>2. Adjust firewall to allow for HTTPS traffic.</p>
                <p>3. Generate the SSL certificate.</p>
                <p>4. Do a renewal dry run so that you know the certication will renew when the time comes.</p>
                <p>5. Go to the URL of the server and you should see a lock to the left of the URL.</p>

                <img src="assets/certificate_lock.png" alt="screenshot of the certificate lock for the Party Animals server">
                <p></p>
                <img src="assets/partyanimals_certificate.png" alt="screenshot of the party animals certificate">
            </section><!-- deployment end -->


            <!-- updating -->
            <section id="updating">
                <h2 class="heading">Updating</h2>
                <p>How do we make changes to the API once it has been deployed and if people are using it?</p>

                <h3>The flow</h3>
                <p>Really a lot of SSH-ing to a remote server.</p>
                <p>Make a separate user on the remotely deployed server called <span class="punctuation">apiuser</span>. This user has a clone of the code base meaning that the updated code can be pulled from GIT.</p>
                <p>Run an <span class="punctuation">npm build</span> && <span class="punctuation">npm start</span> which compiles all our files into the dist directory and then uses pm2 to run.</p>
                <h3></h3>
            </section><!--end of updating-->

            <section id="additional">
                <h3>Extra Resources</h3>
                <ol>
                    <li>Check out the new Full Stack code along <a href="https://github.com/HackerYou/shoparoo" target="_blank"> here</a> </li>
                    <li>Check out Party Animals backend <a href="https://github.com/HackerYou/PartyAnimalsAPI" target="_blank"> here</a> </li>
                    <li>Notes on deploying Node.js to an Ubuntu droplet <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04" target="_blank">here</a></li>
                    <li>Notes on getting Let's Encrypt on Ubuntu droplet <a href="https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-16-04" target="_blank">here</a></li>
                    <li>Helpful tutorial on adding email verification to a Node app <a href="https://codemoto.io/coding/nodejs/email-verification-node-express-mongodb" target="_blank">here</a></li>
                </ol>

                <h3>Thanks for lunching alongside the learning!</h3>
            </section>

        </div><!-- main notes end -->
    </main>
    <script src="script.js"></script>
</body>
</html>